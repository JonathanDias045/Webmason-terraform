---
- name: Create users
  hosts: cfai
  become: true
  tasks:
    - name: Create users
      ansible.builtin.user:
        name: "{{ item.login }}"
        shell: "{{ default_shell }}"
        groups: "{{ item.groups }}"
        append: yes
      loop: "{{ myusers }}"

    - name: Set authorized keys for users
      ansible.posix.authorized_key:
        user: "{{ item.login }}"
        key: "{{ item.pubkey }}"
        state: present
        exclusive: true
      loop: "{{ myusers }}"
